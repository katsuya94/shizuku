FROM node

RUN mkdir /usr/local/web
WORKDIR /usr/local/web

ADD web .

RUN npm install
RUN npx webpack --production

FROM nginx:1.15

ADD nginx/entrypoint.sh /root/entrypoint.sh
ADD nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf
COPY --from=0 /usr/local/web/assets /usr/share/nginx/html/assets
ADD web/public/* /usr/share/nginx/html/

ENTRYPOINT ["/root/entrypoint.sh"]
CMD ["nginx", "-g", "daemon off;"]
